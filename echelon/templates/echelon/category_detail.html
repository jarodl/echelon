{% extends "base.html" %}

{% block title %}Echelon | {{ category.title }}{% endblock %}

{% block base-sidebar %}
  <div id="breadcrumb">
    <a href="/"><span id="breadhome"></span></a>
    {% if category.root_category %}
      <a id="breadcat" href="{{ category.root_category.get_absolute_url }}">{{ category.root_category }}</a>
    {% else %}
      <a id="breadcat" href="{{ category.get_absolute_url }}">{{ category }}</a>
    {% endif %}
  </div>
  <div class="clear"></div>
  <!-- end breadcrumbs -->
  <ul id="sidenav">
    {% for child in category.root_category.category_set.all %}
      <li><a href="{{ child.get_absolute_url }}">{{ child }}</a></li>
      {% empty %}
      {% for child in category.category_set.all %}
        <li><a href="{{ child.get_absolute_url }}">{{ child }}</a></li>
      {% endfor %}
    {% endfor %}
  </ul>
  <!-- end ul sidenav -->
{% endblock %}

{% block base-content %}
  {% load echelon_helpers %}
  {% load markup %}

  <div id="article">
    <div id="art_top">
      <span class="title">{{ category }}</span>
    </div>

    {% if not category.hide_content %}
      <div class="markdown">
        {{ category.content|custom_variables:request|markdown }}
      </div>
    {% endif %}

    <!-- end art_top -->
    {% if not category.hide_links %}
      <ul class="result">
        {% for page in category.page_set.all %}
          <li><a href="{{ page.get_absolute_url }}">{{ page }}</a></li>
        {% endfor %}
      </ul>
      {% for item in category.category_set.all %}
        <div class="resultblock">
          <span class="resultcat"><a href="{{ item.get_absolute_url }}">{{ item }}</a></span>
          <ul>
            {% for page in item.page_set.all %}
              <li><a href="{{ page.get_absolute_url }}">{{ page }}</a></li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    {% endif %}
  </div>

  <div id="marginleft">
    <div id="infobar">
      <p>
        {% if category.parent and category.parent.id != category.id %}
          Posted In
          <a href="{{ category.parent.get_absolute_url }}">{{ category.parent }}</a>
        {% endif %}
        <span class="right">Last updated {{ category.updated }}</span>
      </p>
    </div>
    <!-- end infobar -->
  </div>
  <!-- end marginleft -->
{% endblock %}
